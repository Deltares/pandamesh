
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pandamesh.triangle_mesher &#8212; pandamesh 0.1.0 documentation</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/theme-deltares.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
  <nav class="navbar navbar-dark navbar-expand-lg bg-deltares fixed-top bd-navbar shadow" id="navbar-main"><div class="container-xl">

    <a class="navbar-brand" href="../../index.html">
    <p style="color:#fff;font-size:25px;" class="title">pandamesh</p>
    </a>

    <a class="navbar-brand" href="../../index.html">
    <img src="../../_static/pandamesh-low-res.svg" class="logo" alt="logo" />
    </a>
  
    <div id="navbar-menu" class="collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav">
        <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../introduction.html">
  Introduction
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../examples/index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api.html">
  API Reference
 </a>
</li>

        
      </ul>
    </div>


    <a class="navbar-brand" href="https://www.deltares.nl/en/">
    <img src="../../_static/deltares-white.svg" class="logo" alt="logo" />
    </a>

</div>
  </nav>


    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for pandamesh.triangle_mesher</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pygeos</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="k">as</span> <span class="nn">sg</span>
<span class="kn">import</span> <span class="nn">triangle</span>

<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FloatArray</span><span class="p">,</span>
    <span class="n">IntArray</span><span class="p">,</span>
    <span class="n">check_geodataframe</span><span class="p">,</span>
    <span class="n">flatten</span><span class="p">,</span>
    <span class="n">invalid_option</span><span class="p">,</span>
    <span class="n">separate</span><span class="p">,</span>
    <span class="n">to_pygeos</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">add_linestrings</span><span class="p">(</span><span class="n">linestrings</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">FloatArray</span><span class="p">,</span> <span class="n">IntArray</span><span class="p">]:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linestrings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="n">geometry</span> <span class="o">=</span> <span class="n">linestrings</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">to_pygeos</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
    <span class="n">n_vertex</span> <span class="o">=</span> <span class="n">pygeos</span><span class="o">.</span><span class="n">get_num_coordinates</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
    <span class="n">vertices</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">pygeos</span><span class="o">.</span><span class="n">get_coordinates</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">vertex_numbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_vertex</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n_vertex</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">segments</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertex_numbers</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">segments</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertex_numbers</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="n">segments</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>

    <span class="c1"># If the geometry is closed (LinearRings), the final vertex of every</span>
    <span class="c1"># feature is discarded, since the repeats will segfault Triangle.</span>
    <span class="n">vertices</span><span class="p">,</span> <span class="n">inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">[</span><span class="n">segments</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">segments</span>


<span class="k">def</span> <span class="nf">add_polygons</span><span class="p">(</span>
    <span class="n">polygons</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">FloatArray</span><span class="p">,</span> <span class="n">IntArray</span><span class="p">,</span> <span class="n">FloatArray</span><span class="p">]:</span>
    <span class="n">is_region</span> <span class="o">=</span> <span class="n">polygons</span><span class="p">[</span><span class="s2">&quot;cellsize&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
    <span class="n">n_region</span> <span class="o">=</span> <span class="n">is_region</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">regions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n_region</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">region_points</span> <span class="o">=</span> <span class="n">polygons</span><span class="p">[</span><span class="n">is_region</span><span class="p">]</span><span class="o">.</span><span class="n">representative_point</span><span class="p">()</span>
    <span class="n">regions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_points</span><span class="o">.</span><span class="n">x</span>
    <span class="n">regions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_points</span><span class="o">.</span><span class="n">y</span>
    <span class="n">regions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_region</span><span class="p">)</span>
    <span class="n">cellsize</span> <span class="o">=</span> <span class="n">polygons</span><span class="p">[</span><span class="n">is_region</span><span class="p">][</span><span class="s2">&quot;cellsize&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">regions</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">cellsize</span> <span class="o">*</span> <span class="n">cellsize</span>

    <span class="n">boundary</span> <span class="o">=</span> <span class="n">polygons</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="n">index_parts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">geometry</span>
    <span class="n">vertices</span><span class="p">,</span> <span class="n">segments</span> <span class="o">=</span> <span class="n">add_linestrings</span><span class="p">(</span><span class="n">boundary</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">regions</span>


<span class="k">def</span> <span class="nf">add_points</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FloatArray</span><span class="p">:</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span>
        <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span>
    <span class="k">return</span> <span class="n">vertices</span>


<span class="k">def</span> <span class="nf">polygon_holes</span><span class="p">(</span>
    <span class="n">polygons</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Triangle recognizes holes as a point contained by segments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inner_rings</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">flatten</span><span class="p">(</span><span class="n">polygons</span><span class="o">.</span><span class="n">interiors</span><span class="p">))</span>
    <span class="n">interiors</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span> <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">inner_rings</span><span class="p">])</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">interiors</span><span class="o">.</span><span class="n">representative_point</span><span class="p">()</span>
    <span class="c1"># Filter the points, if the point can be found in a polygon, it&#39;s located</span>
    <span class="c1"># in a refinement zone.</span>
    <span class="n">points_inside</span> <span class="o">=</span> <span class="n">polygons</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span>
        <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">points</span><span class="p">),</span> <span class="n">predicate</span><span class="o">=</span><span class="s2">&quot;contains&quot;</span>
    <span class="p">)</span>
    <span class="n">keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">keep</span><span class="p">[</span><span class="n">points_inside</span><span class="p">[</span><span class="s2">&quot;index_right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">add_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">collect_geometry</span><span class="p">(</span>
    <span class="n">polygons</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">linestrings</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">FloatArray</span><span class="p">,</span> <span class="n">IntArray</span><span class="p">,</span> <span class="n">FloatArray</span><span class="p">]:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygons</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No polygons provided&quot;</span><span class="p">)</span>
    <span class="n">polygon_vertices</span><span class="p">,</span> <span class="n">polygon_segments</span><span class="p">,</span> <span class="n">regions</span> <span class="o">=</span> <span class="n">add_polygons</span><span class="p">(</span><span class="n">polygons</span><span class="p">)</span>
    <span class="n">linestring_vertices</span><span class="p">,</span> <span class="n">linestring_segments</span> <span class="o">=</span> <span class="n">add_linestrings</span><span class="p">(</span><span class="n">linestrings</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
    <span class="n">point_vertices</span> <span class="o">=</span> <span class="n">add_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">linestring_segments</span> <span class="o">+=</span> <span class="n">polygon_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">polygon_vertices</span><span class="p">,</span> <span class="n">linestring_vertices</span><span class="p">,</span> <span class="n">point_vertices</span><span class="p">])</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">polygon_segments</span><span class="p">,</span> <span class="n">linestring_segments</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">regions</span>


<div class="viewcode-block" id="DelaunayAlgorithm"><a class="viewcode-back" href="../../api.html#pandamesh.DelaunayAlgorithm">[docs]</a><span class="k">class</span> <span class="nc">DelaunayAlgorithm</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">DIVIDE_AND_CONQUER</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">INCREMENTAL</span> <span class="o">=</span> <span class="s2">&quot;i&quot;</span>
    <span class="n">SWEEPLINE</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span></div>


<span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> = np.ndarray with shape(</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>


<div class="viewcode-block" id="TriangleMesher"><a class="viewcode-back" href="../../api.html#pandamesh.TriangleMesher">[docs]</a><span class="k">class</span> <span class="nc">TriangleMesher</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper for the python bindings to Triangle. This class must be initialized</span>
<span class="sd">    with a geopandas GeoDataFrame containing at least one polygon, and a column</span>
<span class="sd">    named ``&quot;cellsize&quot;``.</span>

<span class="sd">    Optionally, multiple polygons with different cell sizes can be included in</span>
<span class="sd">    the geodataframe. These can be used to achieve local mesh remfinement.</span>

<span class="sd">    Linestrings and points may also be included. The segments of linestrings</span>
<span class="sd">    will be directly forced into the triangulation. Points can also be forced</span>
<span class="sd">    into the triangulation. The cell size values associated with these</span>
<span class="sd">    geometries willl not be used.</span>

<span class="sd">    Triangle cannot automatically resolve overlapping polygons, or points</span>
<span class="sd">    located exactly on segments. During initialization, the geometries of</span>
<span class="sd">    the geodataframe are checked:</span>

<span class="sd">        * Polygons should not have any overlap with each other.</span>
<span class="sd">        * Linestrings should not intersect each other.</span>
<span class="sd">        * Every linestring should be fully contained by a single polygon;</span>
<span class="sd">          a linestring may not intersect two or more polygons.</span>
<span class="sd">        * Linestrings and points should not &quot;touch&quot; / be located on</span>
<span class="sd">          polygon borders.</span>
<span class="sd">        * Holes in polygons are fully supported, but they most not contain</span>
<span class="sd">          any linestrings or points.</span>

<span class="sd">    If such cases are detected, the initialization will error.</span>

<span class="sd">    For more details on Triangle, see:</span>
<span class="sd">    https://www.cs.cmu.edu/~quake/triangle.defs.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdf</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">check_geodataframe</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>
        <span class="n">polygons</span><span class="p">,</span> <span class="n">linestrings</span><span class="p">,</span> <span class="n">points</span> <span class="o">=</span> <span class="n">separate</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="n">collect_geometry</span><span class="p">(</span>
            <span class="n">polygons</span><span class="p">,</span> <span class="n">linestrings</span><span class="p">,</span> <span class="n">points</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">holes</span> <span class="o">=</span> <span class="n">polygon_holes</span><span class="p">(</span><span class="n">polygons</span><span class="p">)</span>

        <span class="c1"># Set default values for meshing parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_angle</span> <span class="o">=</span> <span class="mf">20.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conforming_delaunay</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suppress_exact_arithmetic</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_steiner_points</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delaunay_algorithm</span> <span class="o">=</span> <span class="n">DelaunayAlgorithm</span><span class="o">.</span><span class="n">DIVIDE_AND_CONQUER</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consistency_check</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">minimum_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Minimum allowed angle for any triangle in the mesh.</span>

<span class="sd">        See:</span>
<span class="sd">        https://www.cs.cmu.edu/~quake/triangle.q.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_angle</span>

    <span class="nd">@minimum_angle</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">minimum_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;minimum angle must be a float&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mf">34.0</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;minimum_angle should fall in the interval: (0.0, 34.0)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_angle</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">conforming_delaunay</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Conforming Delaunay: use this switch if you want all triangles in the</span>
<span class="sd">        mesh to be Delaunay, and not just constrained Delaunay; or if you want</span>
<span class="sd">        to ensure that all Voronoi vertices lie within the triangulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conforming_delaunay</span>

    <span class="nd">@conforming_delaunay</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">conforming_delaunay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;conforming_delaunay must be a bool&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conforming_delaunay</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">suppress_exact_arithmetic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Suppresses exact arithmetic.</span>

<span class="sd">        See:</span>
<span class="sd">        https://www.cs.cmu.edu/~quake/triangle.exact.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suppress_exact_arithmetic</span>

    <span class="nd">@suppress_exact_arithmetic</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">suppress_exact_arithmetic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;suppress_exact_arithmetic must be a bool&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suppress_exact_arithmetic</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">maximum_steiner_points</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Specifies the maximum number of added Steiner points</span>

<span class="sd">        See:</span>
<span class="sd">        https://www.cs.cmu.edu/~quake/triangle.S.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum_steiner_points</span>

    <span class="nd">@maximum_steiner_points</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">maximum_steiner_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;maximum_steiner_points must be an int or None&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maximum_steiner_points</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">delaunay_algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DelaunayAlgorithm</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ``DelaunayAlgoritm.DIVIDE_AND_CONQUER``: Default algorithm.</span>

<span class="sd">        ``DelaunayAlgoritm.INCREMENTAL``: Uses the incremental algorithm for</span>
<span class="sd">        Delaunay triangulation, rather than the divide-and-conquer algorithm.</span>

<span class="sd">        ``DelaunayAlgoritm.SWEEPLINE``: Uses Steven Fortune’s sweepline</span>
<span class="sd">        algorithm for Delaunay triangulation, rather than the</span>
<span class="sd">        divide-and-conquer algorithm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delaunay_algorithm</span>

    <span class="nd">@delaunay_algorithm</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">delaunay_algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">DelaunayAlgorithm</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DelaunayAlgorithm</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">invalid_option</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">DelaunayAlgorithm</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delaunay_algorithm</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">consistency_check</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the consistency of the final mesh. Uses exact arithmetic for</span>
<span class="sd">        checking, even if ``suppress_exact_arithmetic`` is set to ``False``.</span>
<span class="sd">        Useful if you suspect Triangle is buggy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_consistency_check</span>

    <span class="nd">@consistency_check</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">consistency_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;consistency_check must be a bool&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_consistency_check</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="TriangleMesher.generate"><a class="viewcode-back" href="../../api.html#pandamesh.TriangleMesher.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">FloatArray</span><span class="p">,</span> <span class="n">IntArray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a mesh of triangles.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vertices: np.ndarray of floats with shape ``(n_vertex, 2)``</span>
<span class="sd">        triangles: np.ndarray of integers with shape ``(n_triangle, 3)``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;p&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;q</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_minimum_angle</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="s2">&quot;a&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;D&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conforming_delaunay</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;X&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suppress_exact_arithmetic</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;S&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maximum_steiner_points</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum_steiner_points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_delaunay_algorithm</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;C&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">consistency_check</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">tri</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;vertices&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="s2">&quot;segments&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">holes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tri</span><span class="p">[</span><span class="s2">&quot;holes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">holes</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tri</span><span class="p">[</span><span class="s2">&quot;regions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">triangle</span><span class="o">.</span><span class="n">triangulate</span><span class="p">(</span><span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;vertices&quot;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;triangles&quot;</span><span class="p">]</span></div></div>
</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright Huite Bootsma.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.1.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>